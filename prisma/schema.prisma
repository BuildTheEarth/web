generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String           @id @default(uuid())
  ssoId             String           @unique
  discordId         String?
  createdBuildTeams BuildTeam[]      @relation("creator")
  permissions       UserPermission[]
  joinedBuildTeams  BuildTeam[]      @relation("members")
  applications      Application[]    @relation("user")
  reviewed          Application[]    @relation("reviewer")
  claims            Claim[]          @relation("owner")
  claimsBuilder     Claim[]          @relation("builders")
}

model BuildTeam {
  id                   String                @id @default(uuid())
  name                 String                @unique
  icon                 String
  backgroundImage      String
  invite               String
  about                String
  creatorId            String
  createdAt            DateTime              @default(now())
  location             String                @default("")
  slug                 String                @unique @default("")
  applicationQuestions ApplicationQuestion[] @relation("applicationQuestions")
  builds               Build[]               @relation("builds")
  creator              User                  @relation("creator", fields: [creatorId], references: [id])
  showcases            Showcase[]            @relation("showcases")
  socials              Social[]              @relation("socials")
  UserPermission       UserPermission[]
  members              User[]                @relation("members")
  Application          Application[]
  allowTrial           Boolean               @default(false)
  rejectionMessage     String                @default("")
  acceptionMessage     String                @default("")
  trialMessage         String                @default("")
}

model ApplicationQuestion {
  id                String                  @id @default(uuid())
  title             String
  subtitle          String
  placeholder       String                  @default("")
  required          Boolean                 @default(true)
  trial             Boolean                 @default(false)
  type              ApplicationQuestionType
  icon              String
  additionalData    Json                    @default("{}")
  buildTeamId       String
  sort              Int
  buildTeam         BuildTeam               @relation("applicationQuestions", fields: [buildTeamId], references: [id])
  ApplicationAnswer ApplicationAnswer[]
}

model Social {
  id          String    @id @default(uuid())
  name        String
  icon        String
  url         String
  buildTeamId String
  buildTeam   BuildTeam @relation("socials", fields: [buildTeamId], references: [id])
}

model Build {
  id          String    @id @default(uuid())
  name        String
  createdAt   DateTime  @default(now())
  buildTeamId String
  buildTeam   BuildTeam @relation("builds", fields: [buildTeamId], references: [id])
}

model Showcase {
  id          String    @id @default(uuid())
  image       String
  title       String
  createdAt   DateTime  @default(now())
  buildTeamId String
  buildTeam   BuildTeam @relation("showcases", fields: [buildTeamId], references: [id])
}

model UserPermission {
  id          String     @id @default(uuid())
  userId      String
  buildTeamId String?
  permission  String
  buildTeam   BuildTeam? @relation(fields: [buildTeamId], references: [id])
  user        User       @relation(fields: [userId], references: [id])
}

model FAQQuestion {
  id       String @id @default(uuid())
  question String
  answer   String
  links    Json[] @default([])
}

model Contact {
  id      String  @id @default(uuid())
  name    String
  role    String
  discord String?
  email   String?
  avatar  String?
}

model Newsletter {
  id             String   @id @default(uuid())
  issue          Int      @unique
  title          String
  public         Boolean?
  published_date DateTime
  links          String[]
}

model Claim {
  id          String        @id @default(uuid())
  owner       User          @relation("owner", fields: [ownerId], references: [id])
  ownerId     String
  builders    User[]        @relation("builders")
  area        String[]
  center      String
  active      Boolean       @default(false)
  Application Application[]
}

model Application {
  id                String              @id @default(uuid())
  buildteamId       String
  buildteam         BuildTeam           @relation(fields: [buildteamId], references: [id])
  userId            String
  user              User                @relation("user", fields: [userId], references: [id])
  reviewerId        String?
  reviewer          User?               @relation("reviewer", fields: [reviewerId], references: [id])
  status            ApplicationStatus   @default(SEND)
  createdAt         DateTime            @default(now())
  reviewedAt        DateTime?
  reason            String?
  claim             Claim?              @relation(fields: [claimId], references: [id])
  claimId           String?
  trial             Boolean             @default(false)
  ApplicationAnswer ApplicationAnswer[]
}

model ApplicationAnswer {
  id            String              @id @default(uuid())
  applicationId String
  application   Application         @relation(fields: [applicationId], references: [id])
  questionId    String
  question      ApplicationQuestion @relation(fields: [questionId], references: [id])
  answer        String
}

enum ApplicationStatus {
  SEND
  REVIEWING
  TRIAL
  ACCEPTED
  DECLINED
}

enum ApplicationQuestionType {
  TEXT
  SHORT_INPUT
  LONG_INPUT
  DROPDOWN
  CITY
  URL
  MINECRAFT
  SLIDER
  IMAGE
  CHECKBOX
}
